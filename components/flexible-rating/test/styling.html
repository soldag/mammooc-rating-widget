<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <!-- import the element to test -->
    <link rel="import" href="../flexible-rating.html">
  </head>
  <body>
      <test-fixture id="values">
        <style is="custom-style">
            :root {
                --rating-filled-color: rgb(0, 20, 40);
                --rating-unfilled-color: rgb(60, 80, 100);
            }
        </style>
        <template>
          <flexible-rating value="2.6" max="4" disabled>
          </flexible-rating>
        </template>
      </test-fixture>
    <script>
      suite('<flexible-rating>', function() {
        assertStarFill = function(star, ratio) {
            var totalStarWidth = parseFloat(getComputedStyle(star).getPropertyValue('width'));
            var fillStarWidth = parseFloat(getComputedStyle(star.children[1]).getPropertyValue('width'));
            assert.closeTo(fillStarWidth / totalStarWidth, ratio, 0.001);
        }

        var valuesFixture;
        setup(function() {
          valuesFixture = fixture('values');
        });
        test("has 'max' stars", function(done) {
          flush(function() {
              var stars = Polymer.dom(valuesFixture.root).querySelectorAll('.star-wrapper > span');
              assert.equal(stars.length, 4);
              done();
          });
        });
        test("shows 'value' amount of filled stars", function(done) {
          flush(function() {
              var stars = Polymer.dom(valuesFixture.root).querySelectorAll('.star-wrapper > span');
              assertStarFill(stars[0], 1);
              assertStarFill(stars[1], 1);
              assertStarFill(stars[2], 0.6);
              assertStarFill(stars[3], 0);
              done();
          });
        });
        test("has correct style attributes", function(done) {
          flush(function() {
              var stars = Polymer.dom(valuesFixture.root).querySelectorAll('.star-wrapper > span');
              for (var i = 0; i < stars.length; i++) {
                  var star = stars[i];
                  var unfilledColor = getComputedStyle(star).getPropertyValue('color');
                  assert.equal(unfilledColor, 'rgb(60, 80, 100)');
                  var filledColor = getComputedStyle(star.children[1]).getPropertyValue('color');
                  assert.equal(filledColor, 'rgb(0, 20, 40)');
              }
              done();
          });
        });

      });
    </script>
  </body>
</html>
